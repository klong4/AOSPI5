# SELinux policy for AIDL Touchscreen HAL - Android 16
# Raspberry Pi 5 - I2C and SPI Touch Controller Support

type hal_touch_rpi5, domain;
type hal_touch_rpi5_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(hal_touch_rpi5)
binder_use(hal_touch_rpi5)

# Allow Touchscreen HAL to serve AIDL interface
hal_server_domain(hal_touch_rpi5, hal_input)

# I2C device access for touchscreen controllers
# Supports: FT5X06, GT911, ILI251X, Atmel mXT, Synaptics, Elan, Sitronix, etc.
allow hal_touch_rpi5 i2c_device:chr_file rw_file_perms;
allow hal_touch_rpi5 device:chr_file { open read write ioctl };

# SPI device access for SPI touchscreens (ADS7846, TSC2046)
allow hal_touch_rpi5 spidev_device:chr_file rw_file_perms;

# Input device access for evdev
allow hal_touch_rpi5 input_device:chr_file rw_file_perms;
allow hal_touch_rpi5 input_device:dir r_dir_perms;
allow hal_touch_rpi5 device:dir r_dir_perms;

# uinput for touch event injection
allow hal_touch_rpi5 uhid_device:chr_file rw_file_perms;

# GPIO access for touch controller IRQ and RST pins
allow hal_touch_rpi5 gpio_device:chr_file rw_file_perms;
allow hal_touch_rpi5 sysfs_gpio:dir rw_dir_perms;
allow hal_touch_rpi5 sysfs_gpio:file rw_file_perms;

# sysfs access for touch controller status and calibration
allow hal_touch_rpi5 sysfs:dir r_dir_perms;
allow hal_touch_rpi5 sysfs:file rw_file_perms;

# procfs access for touch calibration data
allow hal_touch_rpi5 proc:file r_file_perms;

# Access to input subsystem sysfs
allow hal_touch_rpi5 sysfs_input:dir r_dir_perms;
allow hal_touch_rpi5 sysfs_input:file rw_file_perms;

# Firmware loading for touch controllers
allow hal_touch_rpi5 firmware_file:dir r_dir_perms;
allow hal_touch_rpi5 firmware_file:file r_file_perms;

# Capabilities needed for raw I2C/SPI access
allow hal_touch_rpi5 self:capability { sys_rawio };

# Allow netlink for uevents
allow hal_touch_rpi5 self:netlink_kobject_uevent_socket create_socket_perms_no_ioctl;

vndk_use(hal_touch_rpi5)
